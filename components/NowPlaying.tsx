import React from "react";
import { ReadmeImg, Text } from "./common";

export interface Props {
  cover?: string;
  track: string;
  artist: string;
  progress: number;
  duration: number;
  isPlaying: boolean;
}

export const Player: React.FC<Props> = ({
  cover,
  track,
  artist,
  progress,
  duration,
  isPlaying,
}) => {
  const trackEllipsis =
    track?.length > 27 ? track.substring(0, 27 - 3) + "..." : track;
  const artistEllipsis =
    artist?.length > 50 ? artist.substring(0, 50 - 3) + "..." : artist;
  return (
    <ReadmeImg width="540" height="150">
      <style>
        {`
            .paused { 
              animation-play-state: paused !important;
              background: #e1e4e8 !important;
            }
            
            img {
              border-radius: 60px;
              z-index: 2;
            }

            p {
              color: #E1E4E8;
              display: block;
              opacity: 0;
            }

            .progress-bar {
              position: relative;
              width: 100%;
              height: 4px;
              margin: -1px;
              border: 0.1px solid #4f4f4f;
              border-radius: 4px;
              overflow: hidden;
              padding: 2px;
              padding-right: 30px
              z-index: 0;
            }

            #progress {
              position: absolute;
              top: -1px;
              left: 0;
              width: 100%;
              height: 6px;
              transform-origin: left center;
              background-color: #1DB954;
              animation: progress ${duration}ms linear;
              animation-delay: -${progress}ms;
            }
            
            .progress-bar,
            #track,
            #artist,
            #spotify,
            #cover {
              opacity: 0;
              animation: appear 300ms ease-out forwards;
            }

            #spotify {
              animation-delay: 300ms;
              animation-name: logo-appear;
            }

            #artist {
              animation-delay: 400ms;
            }

            #track {
              animation-delay: 500ms;
            }

            .progress-bar {
              animation-delay: 580ms;
              margin-top: 4px;
            }

            #wrapper {
              position: relative;
            }

            #blurred {
              position: absolute;
              z-index: 0;
              filter: blur(50px);
            }

            #cover {
              z-index: 1;
              position: relative;
              animation-name: cover-appear;
              animation-delay: 300ms;
              box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 3px 10px rgba(0,0,0,0.05);
            }
    
            @keyframes logo-appear {
              from {
                opacity: 0;
                transform: scale(0.9);
              }
              to {
                opacity: 1;
                transform: scale(1);
              }
            }

            @keyframes cover-appear {
              from {
                opacity: 0;
                transform: scale(0.8);
              }
              to {
                opacity: 1;
                transform: scale(1);
              }
            }

            @keyframes appear {
              from {
                opacity: 0;
                transform: translateX(-8px);
              }
              to {
                opacity: 1;
                transform: translateX(0);
              }
            }

            @keyframes progress {
              from {
                transform: scaleX(0)
              }
              to {
                transform: scaleX(1)
              }
            }
        `}
      </style>
      <div
        className={isPlaying ? "disabled" : ""}
        style={{
          marginLeft: 15,
          display: "flex",
          alignItems: "center",
          paddingTop: 20,
          paddingBottom: 20,
          paddingLeft: 40,
          paddingRight: 40,
          background: "#222222",
          width: "500px",
          borderRadius: "14px",
          overflow: "hidden",
          boxShadow:
            "0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19)",
        }}
      >
        {cover ? (
          <div id="wrapper">
            <img id="blurred" src={cover} height="60px" width="auto" />
            <img id="cover" src={cover} height="60px" width="auto" />
          </div>
        ) : null}

        <div
          style={{
            display: "flex",
            flex: 1,
            textAlign: !cover ? "center" : undefined,
            flexDirection: "column",
            marginTop: cover ? -4 : 10,
            marginBottom: !cover ? 10 : undefined,
            marginLeft: cover ? 35 : undefined,
          }}
        >
          {track ? (
            <div>
              <Text id="artist" color="white" weight="black" size="small">
                {artistEllipsis.toUpperCase()}
              </Text>
              <Text id="track" weight="bold" size="large">
                {trackEllipsis}
              </Text>
              <div className="progress-bar">
                <div id="progress" className={!isPlaying ? "paused" : ""} />
              </div>
            </div>
          ) : (
            <Text id="spotify">
              <svg
                width="206"
                height="65"
                viewBox="0 0 206 65"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <g clip-path="url(#clip0)">
                  <g filter="url(#filter0_d)">
                    <path
                      d="M37.1586 4C21.6073 4 9 16.6306 9 32.211C9 47.792 21.6073 60.4216 37.1586 60.4216C52.7115 60.4216 65.3175 47.792 65.3175 32.211C65.3175 16.6316 52.7115 4.00135 37.1582 4.00135L37.1586 4ZM50.0719 44.6883C49.5675 45.517 48.4848 45.7798 47.6576 45.2711C41.0463 41.2252 32.7234 40.3089 22.9217 42.5525C21.9772 42.7681 21.0357 42.1752 20.8205 41.2285C20.6043 40.2819 21.1938 39.3387 22.1406 39.1231C32.867 36.6679 42.0678 37.725 49.4902 42.2695C50.3174 42.7782 50.5796 43.8596 50.0719 44.6883ZM53.5185 37.0068C52.8829 38.0417 51.5312 38.3684 50.4989 37.7317C42.93 33.0707 31.3922 31.7208 22.4396 34.4435C21.2785 34.7948 20.0522 34.1393 19.6998 32.978C19.3501 31.8148 20.0048 30.5885 21.1638 30.2348C31.3902 27.1261 44.1035 28.632 52.7955 33.9833C53.8278 34.62 54.154 35.9742 53.5185 37.0071V37.0068ZM53.8144 29.0079C44.739 23.6074 29.7658 23.1108 21.101 25.7456C19.7096 26.1684 18.2381 25.3814 17.8165 23.9874C17.3948 22.5927 18.1796 21.1195 19.572 20.6957C29.5186 17.6706 46.0537 18.2551 56.5023 24.4695C57.7565 25.2136 58.1668 26.833 57.4237 28.0852C56.6839 29.3391 55.0632 29.7524 53.8157 29.0079H53.8144ZM85.6101 30.0428C80.7479 28.8812 79.8838 28.066 79.8838 26.353C79.8838 24.7346 81.4036 23.6455 83.6666 23.6455C85.8589 23.6455 88.0311 24.4725 90.3109 26.1751C90.3782 26.2266 90.4656 26.2472 90.5496 26.2337C90.6371 26.2209 90.711 26.1741 90.7615 26.1037L93.1354 22.751C93.2329 22.6129 93.206 22.4226 93.0749 22.3171C90.3613 20.1365 87.3082 19.0764 83.7372 19.0764C78.4884 19.0764 74.8199 22.2326 74.8199 26.7485C74.8199 31.5911 77.984 33.3058 83.4514 34.6294C88.1017 35.7031 88.8886 36.6025 88.8886 38.2101C88.8886 39.9922 87.3015 41.1005 84.746 41.1005C81.908 41.1005 79.5913 40.1404 77.0021 37.8968C76.9382 37.8395 76.8508 37.816 76.7701 37.8193C76.6827 37.8261 76.6054 37.8665 76.5516 37.9305L73.8885 41.1039C73.7775 41.2387 73.7909 41.434 73.9187 41.5486C76.9315 44.2436 80.637 45.6652 84.6383 45.6652C90.2941 45.6652 93.9491 42.5693 93.9491 37.7755C93.9599 33.7306 91.5416 31.4904 85.6202 30.0472L85.6101 30.0428ZM106.747 25.2389C104.296 25.2389 102.285 26.2064 100.624 28.189V25.9575C100.624 25.7813 100.482 25.6378 100.308 25.6378H95.9532C95.7783 25.6378 95.6371 25.7813 95.6371 25.9575V50.7521C95.6371 50.9273 95.7783 51.0722 95.9532 51.0722H100.308C100.482 51.0722 100.624 50.9273 100.624 50.7521V42.9264C102.285 44.7894 104.296 45.7023 106.747 45.7023C111.303 45.7023 115.916 42.1887 115.916 35.4716C115.923 28.7532 111.31 25.2386 106.75 25.2386L106.747 25.2389ZM110.852 35.4716C110.852 38.8906 108.751 41.2791 105.738 41.2791C102.762 41.2791 100.516 38.7828 100.516 35.4716C100.516 32.1601 102.762 29.6645 105.738 29.6645C108.7 29.6642 110.852 32.1059 110.852 35.4713V35.4716ZM127.735 25.2389C121.868 25.2389 117.271 29.7652 117.271 35.5447C117.271 41.2622 121.838 45.7394 127.665 45.7394C133.553 45.7394 138.163 41.2285 138.163 35.4716C138.163 29.7342 133.583 25.2396 127.735 25.2396V25.2389ZM127.735 41.3128C124.615 41.3128 122.261 38.7996 122.261 35.4699C122.261 32.1251 124.534 29.6978 127.665 29.6978C130.805 29.6978 133.173 32.2099 133.173 35.543C133.173 38.8872 130.886 41.3128 127.735 41.3128ZM150.691 25.6378H145.9V20.7308C145.9 20.5549 145.758 20.4114 145.584 20.4114H141.229C141.054 20.4114 140.91 20.5549 140.91 20.7308V25.6378H138.818C138.643 25.6378 138.502 25.7813 138.502 25.9575V29.7059C138.502 29.8818 138.643 30.0256 138.818 30.0256H140.91V39.7261C140.91 43.644 142.857 45.6316 146.7 45.6316C148.26 45.6316 149.555 45.3082 150.775 44.6142C150.876 44.5603 150.937 44.4525 150.937 44.3379V40.767C150.937 40.6592 150.88 40.5548 150.785 40.4975C150.691 40.4369 150.574 40.4335 150.476 40.484C149.639 40.9051 148.828 41.1005 147.921 41.1005C146.525 41.1005 145.9 40.4638 145.9 39.0422V30.0273H150.691C150.866 30.0273 151.007 29.8838 151.007 29.7076V25.9595C151.014 25.7833 150.873 25.6398 150.695 25.6398L150.691 25.6378ZM167.383 25.657V25.0543C167.383 23.2813 168.062 22.4906 169.582 22.4906C170.49 22.4906 171.219 22.6712 172.036 22.9441C172.137 22.9757 172.241 22.9599 172.322 22.8996C172.406 22.8393 172.453 22.7426 172.453 22.6402V18.9649C172.453 18.8244 172.366 18.7001 172.228 18.6586C171.367 18.4016 170.264 18.1378 168.61 18.1378C164.592 18.1378 162.463 20.4064 162.463 24.6959V25.6189H160.372C160.197 25.6189 160.052 25.7624 160.052 25.9383V29.7059C160.052 29.8818 160.197 30.0256 160.372 30.0256H162.463V44.9848C162.463 45.1633 162.608 45.3048 162.783 45.3048H167.134C167.312 45.3048 167.453 45.1633 167.453 44.9848V30.0266H171.519L177.746 44.9848C177.04 46.5546 176.344 46.8679 175.395 46.8679C174.629 46.8679 173.818 46.6388 172.995 46.184C172.917 46.1436 172.823 46.1369 172.742 46.1605C172.658 46.1908 172.588 46.2514 172.554 46.3323L171.078 49.5764C171.007 49.7314 171.069 49.9099 171.216 49.9908C172.756 50.8262 174.145 51.1833 175.863 51.1833C179.077 51.1833 180.856 49.6809 182.42 45.645L189.972 26.0936C190.012 25.9952 189.999 25.884 189.938 25.7968C189.881 25.7102 189.784 25.658 189.679 25.658H185.147C185.009 25.658 184.888 25.7446 184.844 25.8722L180.201 39.1567L175.116 25.8635C175.069 25.7398 174.952 25.658 174.821 25.658H167.383V25.657ZM157.705 25.6378H153.351C153.176 25.6378 153.032 25.7813 153.032 25.9575V44.9848C153.032 45.1633 153.176 45.3048 153.351 45.3048H157.705C157.88 45.3048 158.025 45.1633 158.025 44.9848V25.9588C158.025 25.7826 157.884 25.6391 157.705 25.6391V25.6378ZM155.553 16.9736C153.828 16.9736 152.43 18.3723 152.43 20.1001C152.43 21.829 153.828 23.2294 155.553 23.2294C157.278 23.2294 158.674 21.829 158.674 20.1001C158.674 18.3726 157.275 16.9736 155.553 16.9736ZM193.691 31.7558C191.969 31.7558 190.628 30.3696 190.628 28.6862C190.628 27.0028 191.986 25.6007 193.708 25.6007C195.429 25.6007 196.771 26.9866 196.771 28.6687C196.771 30.3521 195.412 31.7558 193.691 31.7558V31.7558ZM193.708 25.9059C192.137 25.9059 190.95 27.1557 190.95 28.6862C190.95 30.216 192.131 31.4489 193.691 31.4489C195.261 31.4489 196.448 30.2001 196.448 28.6687C196.448 27.1389 195.268 25.9059 193.708 25.9059V25.9059ZM194.387 28.9843L195.254 30.1998H194.521L193.741 29.0847H193.072V30.1998H192.46V26.9779H193.893C194.642 26.9779 195.133 27.3609 195.133 28.0057C195.136 28.5339 194.831 28.8567 194.39 28.9843H194.387ZM193.869 27.5307H193.072V28.5498H193.869C194.266 28.5498 194.505 28.3547 194.505 28.0397C194.505 27.7082 194.266 27.5307 193.869 27.5307Z"
                      fill="#1ED760"
                    >
                      <animate
                        id="op"
                        attributeName="opacity"
                        values="1;0.5;0.8;0.9;1"
                        dur="0.25s"
                        begin="4s;op.begin+5s"
                        repeatCount="2"
                      />
                    </path>
                  </g>
                </g>
                <defs>
                  <filter
                    id="filter0_d"
                    x="6"
                    y="1"
                    width="197.771"
                    height="66.4216"
                    filterUnits="userSpaceOnUse"
                    color-interpolation-filters="sRGB"
                  >
                    <feFlood flood-opacity="0" result="BackgroundImageFix" />
                    <feColorMatrix
                      in="SourceAlpha"
                      type="matrix"
                      values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                    />
                    <feOffset dx="2" dy="2" />
                    <feGaussianBlur stdDeviation="2.5" />
                    <feColorMatrix
                      type="matrix"
                      values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.5 0"
                    />
                    <feBlend
                      mode="normal"
                      in2="BackgroundImageFix"
                      result="effect1_dropShadow"
                    />
                    <feBlend
                      mode="normal"
                      in="SourceGraphic"
                      in2="effect1_dropShadow"
                      result="shape"
                    />
                  </filter>
                  <clipPath id="clip0">
                    <rect width="206" height="65" fill="white" />
                  </clipPath>
                </defs>
              </svg>
            </Text>
          )}
        </div>
      </div>
    </ReadmeImg>
  );
};
